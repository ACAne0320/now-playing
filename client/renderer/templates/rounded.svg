<svg width="400" height="120" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <defs>
        <!-- 定义渐变背景 -->
        <linearGradient id="backgroundGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#1a1a2e;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#16213e;stop-opacity:1" />
        </linearGradient>
        
        <!-- 定义圆角遮罩 -->
        <mask id="roundedMask">
            <rect width="400" height="120" rx="12" ry="12" fill="white"/>
        </mask>
        
        <!-- 定义专辑封面圆角遮罩 -->
        <mask id="albumArtMask">
            <rect x="15" y="15" width="90" height="90" rx="8" ry="8" fill="white"/>
        </mask>
        
        <!-- 定义阴影滤镜 -->
        <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
            <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
        </filter>
    </defs>
    
    <style>
        .container { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; 
        }
        .background { 
            fill: url(#backgroundGradient);
        }
        .title { 
            font-size: 20px; 
            font-weight: 600; 
            fill: #ffffff; 
            dominant-baseline: middle;
        }
        .artist { 
            font-size: 16px; 
            fill: #b3b3b3; 
            dominant-baseline: middle;
        }
        .album { 
            font-size: 16px; 
            fill: #888888; 
            dominant-baseline: middle;
        }
        .status-indicator { 
            font-size: 16px;
            font-weight: 500;
        }
        .status-playing { 
            fill: #1ed760; 
        }
        .status-paused { 
            fill: #888888; 
        }
        .no-media-text { 
            font-size: 16px; 
            fill: #888888; 
            text-anchor: middle; 
            dominant-baseline: middle;
        }
        .placeholder-album { 
            fill: #2a2a2a; 
            stroke: #404040; 
            stroke-width: 1;
        }
        .placeholder-icon { 
            fill: #666666; 
            font-size: 24px; 
            text-anchor: middle; 
            dominant-baseline: middle;
        }
        
        /* 用户自定义CSS */
        {{ custom_css | safe }}
    </style>
    
    <!-- 应用圆角遮罩到整个SVG -->
    <g mask="url(#roundedMask)">
        <!-- 背景 -->
        <rect width="400" height="120" class="background" />
        
        <g class="container">
            {% if media_info and media_info.title %}
                <!-- 有媒体信息时的布局 -->
                
                <!-- 专辑封面区域 -->
                {% if media_info.album_art_b64 %}
                    <!-- 真实专辑封面 -->
                    <image href="data:image/png;base64,{{ media_info.album_art_b64 }}" 
                           x="15" y="15" width="90" height="90" 
                           mask="url(#albumArtMask)" 
                           filter="url(#shadow)"/>
                {% else %}
                    <!-- 占位符专辑封面 -->
                    <rect x="15" y="15" width="90" height="90" 
                          rx="8" ry="8" 
                          class="placeholder-album" 
                          filter="url(#shadow)"/>
                    <text x="60" y="60" class="placeholder-icon">🎵</text>
                {% endif %}
                
                <!-- 文本信息区域（右侧） -->
                <g transform="translate(125, 0)">

                    <!-- 歌曲标题 -->
                    <text x="0" y="28" class="title">
                        {% if media_info.title|length > 23 %}
                            {{ media_info.title[:23] }}...
                        {% else %}
                            {{ media_info.title }}
                        {% endif %}
                    </text>
                    
                    <!-- 艺术家 -->
                    <text x="0" y="50" class="artist">
                        {% if media_info.artist|length > 30 %}
                            {{ media_info.artist[:30] }}...
                        {% else %}
                            {{ media_info.artist }}
                        {% endif %}
                    </text>
                    
                    <!-- 专辑名称 -->
                    {% if media_info.album %}
                    <text x="0" y="88" class="album">
                        {% if media_info.album|length > 30 %}
                            {{ media_info.album[:30] }}...
                        {% else %}
                            {{ media_info.album }}
                        {% endif %}
                    </text>
                    {% endif %}
                </g>

                    {% if media_info.is_playing %}
                        <circle cx="380" cy="105" r="5" class="status-playing" />
                    {% else %}
                        <circle cx="380" cy="105" r="5" class="status-paused" />
                    {% endif %}
                
            {% else %}
                <!-- 没有媒体信息时的布局 -->
                
                <!-- 占位符专辑封面 -->
                <rect x="15" y="15" width="90" height="90" 
                      rx="8" ry="8" 
                      class="placeholder-album" 
                      filter="url(#shadow)"/>
                <text x="60" y="60" class="placeholder-icon">🎵</text>
                
                <!-- 无媒体文本 -->
                <text x="275" y="60" class="no-media-text">暂无播放内容</text>
                
            {% endif %}
        </g>
    </g>
</svg>
